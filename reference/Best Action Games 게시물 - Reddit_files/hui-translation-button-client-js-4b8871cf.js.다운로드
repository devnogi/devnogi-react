import{t,_ as e,G as a,g as i,a as s,c as n,C as o,u as l,v as r,e as c,n as h,az as d,eV as u,eW as p,eX as m,eY as C,aA as b,o as k,l as v,L as g,eZ as f,aB as w,dy as T,I as x,O as A,w as y,e_ as D,e$ as S,f0 as B}from"./shell-47d14d7f.js";import{S as M}from"./faceplate-switch-input-efa0410b.js";import{a as $,s as F,x as I,M as E,I as V,bM as j,bN as z,bf as O,A as L}from"./icon-feb8496e.js";import{l as N,L as R}from"./list-item-header-bb203cd0.js";import{a as G,T as _}from"./faceplate-textarea-input-ae98fb49.js";import{j as U,k as P,l as q,T as Q,m as Y,n as W}from"./translations-9b835411.js";import{e as X,f as H,g as J,h as K,i as Z,j as tt,k as et}from"./translation-9b3faeec.js";import"./app-selector-client-js-979df606.js";import"./select-controller-4bbbb950.js";import"./table-pagination-59fbba3e.js";import"./rpl-coachmark-7839db9c.js";import"./rpl-coachmark-card-97f74d54.js";import"./helpers-2f40d61f.js";import"./constants-d95f0f33.js";import"./community-picker-991cd74c.js";import"./age-gate-standalone-client-js-2c5a180c.js";import"./text-input-b514202a.js";import"./links-d16464b2.js";import"./message-composer-utils-be593e8d.js";import"./user-flair-602fac54.js";import"./tooltip.base-6bd30da2.js";import"./utils-b9d9442f.js";var at;!function(t){t.GREAT="great",t.NOT_GREAT="not great"}(at||(at={}));let it=class extends F{constructor(){super(...arguments),this.otherReasonFormValue="",this.isOpen=!1,this.handleDismiss=()=>{s(this,U()),this.close()}}show(){s(this,P()),this.faceplateDialog?.showModal?.(),this.isOpen=!0}close(){this.faceplateDialog?.close?.(),this.isOpen=!1,this.selectedOption=void 0,this.otherReasonFormValue=""}showThankYouAlert(){this.dispatchEvent(n("faceplate-alert",{level:o.success,message:"평가해 주셔서 감사합니다"}))}handleUpvoteTranslation(){this.selectedOption=at.GREAT}handleDownvoteTranslation(){this.selectedOption=at.NOT_GREAT}handleSubmit(){this.selectedOption&&(s(this,q({reason:this.selectedOption,survey_text:this.otherReasonFormValue})),this.showThankYouAlert(),this.close())}render(){return I` <faceplate-dialog id="global-translation-feedback-faceplate-dialog" class="translation-feedback"> <div class="flex flex-col gap-lg"> <div class="flex justify-between"> <h3 class="font-bold text-24 text-neutral-content-strong m-0" data-testid="modal-title"> \uBC88\uC5ED\uC5D0 \uB9CC\uC871\uD558\uC2DC\uB098\uC694? </h3> ${l({attributes:{onclick:this.handleDismiss},appearance:"secondary",leadingIcon:E({size:V.Medium}),size:r.Medium})} </div> <p class="m-0" data-testid="modal-subtitle"> \uBC88\uC5ED\uB41C Reddit \uC774\uC6A9 \uD658\uACBD\uC5D0 \uB300\uD55C \uC758\uACAC\uC744 \uACF5\uC720\uD574\uC8FC\uC138\uC694. </p> <div class="flex justify-center gap-md"> <button data-testid="upvote-translation" class="py-md px-lg cursor-pointer border-none rounded-md ${this.selectedOption===at.GREAT?"bg-neutral-background-selected":"bg-neutral-background-medium"}" @click="${this.handleUpvoteTranslation}" @keydown="${this.handleUpvoteTranslation}"> <img src="${CLIENT_CONFIG.STATIC_BASE_URL}assets/snoomojis/Snoo_Expression_Smile_EyesOpen.png" class="block m-auto pb-xs" width="56" height="56" alt=""> <p class="font-semibold text-14 text-center text-neutral-content-strong m-0"> \uD6CC\uB96D\uD574\uC694 </p> </button> <button data-testid="downvote-translation" class="py-md px-lg cursor-pointer border-none rounded-md ${this.selectedOption===at.NOT_GREAT?"bg-neutral-background-selected":"bg-neutral-background-medium"}" @click="${this.handleDownvoteTranslation}" @keydown="${this.handleDownvoteTranslation}"> <img src="${CLIENT_CONFIG.STATIC_BASE_URL}assets/snoomojis/Snoo_Expression_Blanc.png" class="block m-auto pb-xs" width="56" height="56" alt=""> <p class="font-semibold text-14 text-center text-neutral-content-strong m-0"> \uC544\uC26C\uC6CC\uC694 </p> </button> </div> ${this.selectedOption?I` <div class="flex w-full box-border"> <faceplate-textarea-input data-testid="other-reason-input" maxlength="500" appearance="${G.BORDERED}" size="${_.EXPANDED}" @keyup="${t=>{t.stopPropagation(),this.otherReasonFormValue=t.target.value}}" class="w-full" .value="${this.otherReasonFormValue}"> <span slot="label">\uB313\uAE00\uC744 \uB0A8\uACA8 \uBCF4\uC138\uC694(\uC120\uD0DD \uC0AC\uD56D)</span> </faceplate-textarea-input> </div> `:I``} <div class="flex justify-end"> ${l({appearance:"primary",size:r.Large,shape:"pill",attributes:{onclick:this.handleSubmit,className:"flex box-border","data-testid":"submit-feedback-button",disabled:!this.selectedOption},children:I`<span class="font-semibold text-14">\uD53C\uB4DC\uBC31 \uBCF4\uB0B4\uAE30</span>`})} </div> </div> </faceplate-dialog> `}};it.styles=[$`.translation-feedback{border-radius:16px;max-width:400px;padding:2rem 1.5rem 1.5rem 1.5rem;width:82%}`,t],e([a("#global-translation-feedback-faceplate-dialog")],it.prototype,"faceplateDialog",void 0),e([i()],it.prototype,"selectedOption",void 0),e([i()],it.prototype,"otherReasonFormValue",void 0),e([i()],it.prototype,"isOpen",void 0),it=e([c("global-translation-feedback-modal")],it);const st="reddit-cookie-banner",nt="faceplate-bottom-sheet#xpromo-bottom-sheet",ot="faceplate-modal#blocking-modal",lt=F;function rt(t){return!!t?.open}let ct=class extends lt{constructor(){super(...arguments),this.activatableFeatures=[u,p,m,C],this.isDesktop=!1,this.withFeedback=!1,this.withActivatedFeatures=!1,this.translationContextValue=b,this.withCoachmark=!1,this.withTranslationSettings=!1,this.hasCoachmarkDisplayLimit=!1,this.translationActiveMsg="번역 설정됨",this.handleTranslationActiveSwitch=()=>{const t=!this.translationContextValue.isTranslationActive;this.dispatchContextUpdateEvent({isTranslationActive:t})},this.closeTranslationCoachmark=()=>{this.translationCoachmark?.hide?.(),this.onCoachmarkClose()},this.openTranslationCoachmark=()=>{s(this,X(!!this.translationContextValue.isTranslationActive)),this.translationCoachmark?.show?.()},this.openTranslationMenu=()=>{s(this,H(!!this.translationContextValue.isTranslationActive)),this.isDesktop?this.translationDropdownMenu?.show?.():this.translationMenuBottomSheet?.showModal?.()},this.closeTranslationMenu=()=>{s(this,H(!!this.translationContextValue.isTranslationActive)),this.isDesktop?this.translationDropdownMenu?.close?.():this.translationMenuBottomSheet?.close?.()},this.openFeedbackModal=()=>{this.translationFeedbackModal?.show?.()},this.handleCoachmarkSettingsClick=()=>{this.closeTranslationCoachmark(),this.openTranslationMenu(),s(this,J(K.UpdateSettings))},this.handleTranslationActiveClick=t=>{t.stopPropagation(),s(this,Z(!!this.translationContextValue.isTranslationActive))},this.handleCoachmarkClick=t=>{t.stopPropagation()},this.handleCoachmarkCloseClick=()=>{this.closeTranslationCoachmark(),s(this,J(K.Dismiss))},this.handleNavMobileButtonClick=()=>{this.activateFeatures(),this.openTranslationMenu(),s(this,tt(!!this.translationContextValue.isTranslationActive))},this.handleNavbarButtonClick=()=>{this.activateFeatures(),s(this,tt(!!this.translationContextValue.isTranslationActive)),s(this,H(!!this.translationContextValue.isTranslationActive))},this.handleGiveFeedbackButtonClick=()=>{this.openFeedbackModal(),this.closeTranslationMenu()},this.onCoachmarkClose=()=>{setTimeout((()=>{this.dispatchContextUpdateEvent({shouldDisplayCoachmark:!1,shouldDisplayFeedbackCoachmark:!0})}),500)},this._activateFeature=k}connectedCallback(){super.connectedCallback();"mtseo-disabled"===v.getItem(g.I18nTranslationInterventionShown)&&(setTimeout((()=>{this.dispatchEvent(n("faceplate-alert",{level:o.success,message:"번역 기능이 비활성화되었습니다."}))}),1e3),v.setItem(g.I18nTranslationInterventionShown,"true"))}updated(t){this.withCoachmark&&!this.hasCoachmarkDisplayLimit&&t.has("translationContextValue")&&void 0!==this.translationContextValue.isTranslationActive&&this.displayCoachmark()}displayCoachmark(){const{coachmarkDisplayCount:t,shouldDisplayCoachmark:e}=this.translationContextValue;window.setTimeout((()=>{if(!e)return;if(this.hasCoachmarkObstacles())return;const a=t<1;this.dispatchContextUpdateEvent({coachmarkDisplayCount:t+1,shouldDisplayCoachmark:a,shouldDisplayFeedbackCoachmark:!a}),a&&this.openTranslationCoachmark(),this.hasCoachmarkDisplayLimit=!0}),1500)}hasCoachmarkObstacles(){const t=!!document.querySelector(st),e=function(t){const e=document.querySelector(t);return e?T(rt,e):[]}(nt),a=!!document.querySelector(ot);return t||e?.length>0||a}dispatchContextUpdateEvent(t){const e={...this.translationContextValue,...t},a=new CustomEvent("update-translation-context",{bubbles:!0,composed:!0,detail:e});this.dispatchEvent(a)}featureShouldBeActivated(t){return!!document.querySelector(`faceplate-loader[name=${t}]`)&&!!document.querySelector(`faceplate-partial[name=${t}]`)&&!f(t)}activateFeatures(){return this.withActivatedFeatures?Promise.all(this.activatableFeatures.filter(this.featureShouldBeActivated).map((t=>this._activateFeature({name:t})))):Promise.resolve()}renderCoachmark(){return this.translationContextValue.shouldDisplayCoachmark?I`<rpl-coachmark-card slot="content" appearance="inverted"> ${j({size:V.Small,attributes:{slot:"title-icon"}})} <span slot="title" class="whitespace-nowrap">${this.translationActiveMsg}</span> <p class="max-w-[10rem] xs:max-w-none"> ${this.translationContextValue.isTranslationActive?"게시물과 댓글이 자동으로 번역됩니다":"게시물 및 댓글 자동 번역"} </p> ${l({attributes:{"aria-label":"닫기",id:"coachmark-close-button",onclick:this.handleCoachmarkCloseClick,slot:"close-button"},appearance:"plainInverted",leadingIcon:E({size:V.Small}),size:r.Small})} ${l({attributes:{slot:"primary-button",id:"coachmark-settings-button",onclick:this.handleCoachmarkSettingsClick},children:"설정",appearance:"plainInverted",size:r.Small})} </rpl-coachmark-card>`:I``}renderDesktopMenu(){return I`<faceplate-dropdown-menu position="bottom-end" id="translation-desktop-menu"> ${l({size:r.Medium,appearance:"plain",shape:"pill",leadingIcon:z({size:V.Medium}),attributes:{id:"translation-menu-button","aria-label":this.translationActiveMsg,onclick:this.handleNavbarButtonClick}})} <faceplate-menu slot="menu" dropdown hidden> ${N({label:I` <faceplate-switch-input id="hui-translation-switch" appearance="${M.PRIMARY}" class="inline-flex flex-row-reverse gap-sm" ?checked="${this.translationContextValue.isTranslationActive}" @input="${this.handleTranslationActiveSwitch}" @click="${this.handleTranslationActiveClick}"> <span class="-ml-xs">${this.translationActiveMsg}</span> </faceplate-switch-input> `,size:R.Medium})} ${this.withTranslationSettings?N({label:I` <span class="flex flex-row items-center"> ${O({size:V.Medium})} <span class="ml-xs"> \uBC88\uC5ED \uC124\uC815 </span> </span> `,attributes:{id:"translation-settings-list-item"},size:R.Medium,href:"/settings/preferences"}):L} ${this.withFeedback?N({label:"Give translation feedback",attributes:{"data-testid":"hui-translation-button-feedback-option"},size:R.Medium,onClick:this.handleGiveFeedbackButtonClick}):L} </faceplate-menu> </faceplate-dropdown-menu>`}renderMobileMenu(){return I`<div> ${l({size:r.Medium,appearance:"plain",shape:"pill",leadingIcon:z({size:V.Medium}),attributes:{id:"translation-menu-button",onclick:this.handleNavMobileButtonClick,"aria-label":this.translationActiveMsg}})} <faceplate-bottom-sheet id="translation-mobile-menu"> <div class="p-md flex flex-col items-stretch w-full gap-md"> <faceplate-switch-input id="hui-translation-switch" appearance="${M.PRIMARY}" class="flex flex-row-reverse justify-between gap-sm px-xs" ?checked="${this.translationContextValue.isTranslationActive}" @input="${this.handleTranslationActiveSwitch}" @click="${this.handleTranslationActiveClick}"> <span class="inline-flex items-center gap-xs"> ${z({size:V.Medium})} <span> ${this.translationActiveMsg} </span> </span> </faceplate-switch-input> ${this.withFeedback?N({label:"Give translation feedback",attributes:{"data-testid":"hui-translation-button-feedback-option"},size:R.Medium,onClick:this.handleGiveFeedbackButtonClick}):L} </div> </faceplate-bottom-sheet> </div>`}render(){return I` <rpl-coachmark placement="${this.isDesktop?"bottom-end":"bottom"}" appearance="inverted" id="translation-coachmark" @click="${this.handleCoachmarkClick}" @rpl-coachmark:after-hide="${this.onCoachmarkClose}" style="--max-width:fit-content"> <div>${this.isDesktop?this.renderDesktopMenu():this.renderMobileMenu()}</div> ${this.renderCoachmark()} </rpl-coachmark> ${this.withFeedback?I` <global-translation-feedback-modal id="hui-translation-button-feedback-modal"></global-translation-feedback-modal>`:L} `}};ct.styles=[t],e([h({type:Boolean,attribute:"is-desktop"})],ct.prototype,"isDesktop",void 0),e([h({type:Boolean,attribute:"with-feedback"})],ct.prototype,"withFeedback",void 0),e([h({type:Boolean,attribute:"with-activated-features"})],ct.prototype,"withActivatedFeatures",void 0),e([d({context:w,subscribe:!0}),i()],ct.prototype,"translationContextValue",void 0),e([h({type:Boolean,attribute:"with-coachmark"})],ct.prototype,"withCoachmark",void 0),e([h({type:Boolean,attribute:"with-translation-settings"})],ct.prototype,"withTranslationSettings",void 0),e([i()],ct.prototype,"hasCoachmarkDisplayLimit",void 0),e([a("#translation-coachmark")],ct.prototype,"translationCoachmark",void 0),e([a("#translation-desktop-menu")],ct.prototype,"translationDropdownMenu",void 0),e([a("#translation-mobile-menu")],ct.prototype,"translationMenuBottomSheet",void 0),e([a("#hui-translation-button-feedback-modal")],ct.prototype,"translationFeedbackModal",void 0),ct=e([c("hui-translation-button")],ct);let ht=class extends F{constructor(){super(...arguments),this.translationContextValue=b,this.isNewAccountAge=!1,this.isNewImmersiveVisit=!1,this.withBackendSetting=!1,this.newPreferredLanguages=[],this.requestClientGQL=x}connectedCallback(){super.connectedCallback(),this.isSettingInitialized()?this.syncTranslationSettingsWithCookie():this.initializeTranslationSettings(),this.newPreferredLanguages.length>0&&this.initializePreferredLanguageSettings()}initializePreferredLanguageSettings(){this.requestClientGQL({operation:A.UpdatePreferredLanguagesPreference,variables:{input:{languages:this.newPreferredLanguages}}})}updated(t){if(!t.has("translationContextValue")||!this.withBackendSetting)return;const e=t.get("translationContextValue"),a=this.translationContextValue.isTranslationActive,i=e?.isTranslationActive;if(void 0===i)return;(!0!==i&&!0===a||!1!==i&&!1===a)&&this.saveTranslationSettingInAccount(a)}async initializeTranslationSettings(){const t=this.fetchTranslationSettingFromCookie(),e=await this.fetchTranslationSettingFromGQL();let a,i={...this.translationContextValue};if(t&&(i={...i,...t}),null!==e&&e!==t?.isTranslationActive&&(i={...i,isTranslationActive:e},a=Q.BACKEND),null===t&&null===e){const[t,e]=this.getFallbackIsTranslationActive();a=e,i={...i,isTranslationActive:t}}this.dispatchContextUpdateEvent(i),null===e&&void 0!==i.isTranslationActive&&this.saveTranslationSettingInAccount(i.isTranslationActive),a&&(i.isTranslationActive?s(this,Y(a)):s(this,W(a))),sessionStorage.setItem(g.TranslationInitialized,Date.now().toString()),s(this,et(!!i.isTranslationActive))}getFallbackIsTranslationActive(){return this.isNewImmersiveVisit,this.isNewAccountAge?[!0,Q.ACCOUNT_AGE]:[!1,Q.DEFAULT_OFF]}syncTranslationSettingsWithCookie(){const t=this.fetchTranslationSettingFromCookie();let e={...this.translationContextValue};t&&t.isTranslationActive!==e.isTranslationActive&&(e={...e,...t},this.dispatchContextUpdateEvent(e)),s(this,et(!!e.isTranslationActive))}fetchTranslationSettingFromCookie(){const t=y.get(D)??"";return S(t)}async fetchTranslationSettingFromGQL(){if(!this.withBackendSetting)return null;try{const{data:t}=await this.requestClientGQL({operation:A.IdentityImmersiveTranslationSetting}),e=t.identity?.preferences?.isMachineTranslationImmersive;return null==e||e===B.Unset?null:e===B.Enabled}catch{}return null}async saveTranslationSettingInAccount(t){if(!this.withBackendSetting)return null;try{await this.requestClientGQL({operation:A.UpdateAccountPreferences,variables:{input:{isMachineTranslationImmersive:t?B.Enabled:B.Disabled}}})}catch{}return null}dispatchContextUpdateEvent(t){const e=new CustomEvent("update-translation-context",{bubbles:!0,composed:!0,detail:t});this.dispatchEvent(e)}isSettingInitialized(){const t=sessionStorage.getItem(g.TranslationInitialized);return!!(t&&Date.now()-parseInt(t,10)<36e5)}render(){return I`<div> <slot></slot> </div>`}};e([d({context:w,subscribe:!0}),i()],ht.prototype,"translationContextValue",void 0),e([h({type:Boolean,attribute:"is-new-account-age"})],ht.prototype,"isNewAccountAge",void 0),e([h({type:Boolean,attribute:"is-new-immersive-visit"})],ht.prototype,"isNewImmersiveVisit",void 0),e([h({type:Boolean,attribute:"with-backend-setting"})],ht.prototype,"withBackendSetting",void 0),e([h({type:Array,attribute:"new-preferred-languages"})],ht.prototype,"newPreferredLanguages",void 0),ht=e([c("translation-settings-admin")],ht);
