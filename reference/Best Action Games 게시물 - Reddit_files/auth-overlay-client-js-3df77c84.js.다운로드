import"./shreddit-overlay-display-a42adbd8.js";import{t,_ as e,n as s,g as i,E as o,bn as a,c as n,Z as r,r as l,e as h,o as c}from"./shell-47d14d7f.js";import{S as p}from"./scroll-blocker-9a530e38.js";import{R as d,D as u}from"./age-gate-standalone-client-js-2c5a180c.js";import{s as m,A as f,x as g,l as y}from"./icon-feb8496e.js";let b=c,k=window.location,S=class extends m{constructor(){super(...arguments),this.stepName=null,this.isStandalonePage=!1,this.open=!1,this.history=[],this.events=new o(this),this.scrollBlocker=new p(this),this.findStepElement=t=>this.querySelector(`[slot="${t}"]`),this.requestClose=()=>{this.blocking?this.isStandalonePage&&this.redirectToHome():this.close()},this.redirectToHome=()=>{k.href=location.origin},this.handleEscKey=this.events.define("keydown",(t=>{"Escape"!==t.key||this.blocking||this.close()})),this.deprecated__onFaceplateTrack=this.events.define("faceplate-track",(t=>{const{source:e,action:s,noun:i}=t.detail;e===d&&s===u&&a.has(i)&&this.requestClose()}))}get blocking(){if(this.isStandalonePage)return!0;if(this.open&&this.stepName){const t=this.findStepElement(this.stepName);return t?.hasAttribute("blocking")}return!1}connectedCallback(){if(super.connectedCallback(),null!==this.stepName){const t=new URLSearchParams(window.location.search).get("action_source");this.show(this.stepName,{queryParams:{...t&&{actionSource:t}}})}}hasStep(t){return!!this.findStepElement(t)}onInitialFlowOpen(){this.open||this.dispatchEvent(n("auth-flow-initial-open"))}async show(t,e){const s=this.findStepElement(t),i=s?.getAttribute("feature-name"),o=r();if(!s||!i)return!1;try{const t={...e?.queryParams,is_standalone:this.isStandalonePage};o&&(t.source_page=o.toString()),await b({root:s,name:i,renderMode:l.Contents,...e,queryParams:t})}finally{this.onInitialFlowOpen(),this.open=!0,this.history.push(t),this.stepName=t,this.scrollBlocker.blockPageScrolling()}return!0}back(){if(!this.open)return;this.history.pop();const t=this.history.at(-1);if(!t)return this.requestClose();this.stepName=t}close(){this.dispatchEvent(n("auth-flow-dismiss")),this.open=!1,this.stepName=null,this.history=[],this.scrollBlocker.unblockPageScrolling()}render(){return this.open?g` <div class="z-[100] fixed"> <div class="${y(this.isStandalonePage?void 0:"fixed top-0 right-0 bottom-0 left-0 bg-black opacity-50 backdrop-blur-sm")}" tabindex="-1" @click="${this.requestClose}"></div> <slot name="${this.stepName}"></slot> <slot></slot> </div> `:f}};S.styles=[t],e([s({attribute:"step-name",type:String,reflect:!0})],S.prototype,"stepName",void 0),e([s({attribute:"is-standalone",type:Boolean})],S.prototype,"isStandalonePage",void 0),e([i()],S.prototype,"open",void 0),S=e([h("auth-flow-manager")],S);
